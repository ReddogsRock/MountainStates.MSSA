"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_metadata_metadata_component_ts-projects_eav-ui_src_app_shared_service-802177","projects_eav-ui_src_app_permissions_permissions_routing_ts"],{336:(F,m,e)=>{e.d(m,{F:()=>M});var c=e(46443),l=e(14600),i=e(36647),a=e(70271),p=e(78742),h=e(70693),D=e(34435),C=e(9234),y=e(24467),g=e(99293),E=e(44444);const _={getAll:!0,getAllLive:!0,getAllOnce:!0};let M=(()=>{class u extends y.B{constructor(){super(...arguments),this.log=(0,D.Tq)({ContentItemsService:u},_)}getAllPromise(v){return this.log.fnIf("getAll",{contentTypeStaticName:v}),this.fetchPromise(C.Gg,{params:{appId:this.appId,contentType:v}})}getAllOnce(v){return this.log.fnIf("getAllOnce",{contentTypeStaticName:v}),(0,c.fx)(()=>({url:this.apiUrl(C.Gg),params:{appId:this.appId,contentType:v}}))}getAllLive(v,f){return this.log.fnIf("getAllLive",{contentTypeStaticName:v,refresh:f}),(0,c.fx)(()=>(f(),{url:this.apiUrl(C.Gg),params:{appId:this.appId,contentType:v}}))}getColumnsPromise(v){return this.fetchPromise(p.z,{params:{appId:this.appId,staticName:v}})}importItem(v){return(0,l.H)((0,h.n)(v)).pipe((0,i.n)(f=>this.http.post(this.apiUrl(C.gb+"upload"),{AppId:this.appId,ContentBase64:f})),(0,a.T)(f=>({Success:f,Messages:[]})))}static#t=this.\u0275fac=(()=>{let v;return function(d){return(v||(v=g.xGo(u)))(d||u)}})();static#e=this.\u0275prov=E.jDH({token:u,factory:u.\u0275fac})}return u})()},4096:(F,m,e)=>{e.d(m,{Kn:()=>h.K,TI:()=>p.T,k4:()=>c.k});var c=e(72437),p=(e(42365),e(43516),e(12458),e(80401)),h=e(44900)},4979:(F,m,e)=>{e.d(m,{V:()=>i});var c=e(27092),l=e(44444);let i=(()=>{class a{constructor(){this.subscriptions=new c.yU}ngOnDestroy(){this.destroy()}destroy(){this.subscriptions.unsubscribe()}static#t=this.\u0275fac=function(D){return new(D||a)};static#e=this.\u0275prov=l.jDH({token:a,factory:a.\u0275fac})}return a})()},4982:(F,m,e)=>{e.r(m),e.d(m,{MetadataComponent:()=>jt});var c=e(87945),l=e(44444),i=e(64173),a=e(16256),p=e(84175),h=e(81863),D=e(93840),C=e(29658),y=e(23183),g=e(12938),E=e(13620),_=e(6663),M=e(336),u=e(9006),T=e(4096),v=e(21183),f=e(11828),d=e(68163),B=e(60251),x=e(59339),L=e(91922),H=e(34435),W=e(70334),X=e(67037),V=e(69914),S=e(60852),tt=e(96817),P=e(89061),O=e(34601),t=e(99293),b=e(29968);let K=(()=>{class o{agInit(n){this.params=n}refresh(n){return!0}deleteMetadata(){this.params.onDelete(this.params.data)}static#t=this.\u0275fac=function(r){return new(r||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-metadata-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(r,s){1&r&&(t.j41(0,"div",0)(1,"div",1),t.bIt("click",function(){return s.deleteMetadata()}),t.j41(2,"mat-icon"),t.EFF(3,"delete"),t.k0s()()())},dependencies:[P.M,b.M,D.m_,D.An,O.e],encapsulation:2})}return o})(),et=(()=>{class o{agInit(n){this.value=n.value,this.metadata=n.data}refresh(n){return!0}static#t=this.\u0275fac=function(r){return new(r||o)};static#e=this.\u0275cmp=t.VBU({type:o,selectors:[["app-metadata-content-type"]],decls:2,vars:2,consts:[[1,"container",3,"tippy"]],template:function(r,s){1&r&&(t.j41(0,"div",0),t.EFF(1),t.k0s()),2&r&&(t.Y8G("tippy",s.metadata._Type.Description),t.R7$(),t.SpI(" ",s.value,"\n"))},dependencies:[O.e],styles:[".container[_ngcontent-%COMP%]{width:fit-content}"]})}return o})();var U=e(34456),nt=e(31403),at=e(31016),z=e(59791),Z=e(64043),Q=e(8827),ot=e(63037),it=e(91817),st=e(75445),rt=e(32760),lt=e(43758),J=e(5858),k=e(50052),dt=e(39333),ct=e(99277),N=e(87698),pt=e(23731),w=e(8923);const q=o=>({active:o});function mt(o,I){if(1&o&&(t.j41(0,"mat-option",18),t.EFF(1),t.k0s()),2&o){const n=I.$implicit;t.Y8G("value",n.value),t.R7$(),t.SpI(" ",n.name," ")}}function ht(o,I){if(1&o&&(t.j41(0,"mat-form-field",7)(1,"mat-label"),t.EFF(2,"Scope"),t.k0s(),t.j41(3,"mat-select",17),t.Z7z(4,mt,2,2,"mat-option",18,t.fX1),t.j41(6,"mat-option",18),t.EFF(7,"Other..."),t.k0s()()(),t.j41(8,"app-field-hint"),t.EFF(9," The scope should almost never be changed - "),t.j41(10,"a",19),t.EFF(11,"see help"),t.k0s()()),2&o){const n=t.XpG();t.R7$(3),t.Y8G("placeholder",n.scopeOptions().length?"":"No items found"),t.R7$(),t.Dyx(n.scopeOptions()),t.R7$(2),t.Y8G("value",n.dropdownInsertValue)}}function gt(o,I){if(1&o&&(t.j41(0,"mat-option",18),t.EFF(1),t.k0s()),2&o){const n=I.$implicit;t.Y8G("value",n.NameId),t.R7$(),t.SpI(" ",n.Label," ")}}function ut(o,I){if(1&o&&(t.j41(0,"mat-select",8),t.Z7z(1,gt,2,2,"mat-option",18,t.fX1),t.k0s()),2&o){let n;const r=t.XpG();t.Y8G("placeholder",null!=(n=r.contentTypes())&&n.length?"":"No items found"),t.R7$(),t.Dyx(r.contentTypes())}}function ft(o,I){1&o&&t.nrm(0,"input",9)}function _t(o,I){1&o&&(t.j41(0,"app-field-hint",13),t.EFF(1," This field is required "),t.k0s()),2&o&&t.Y8G("isError",!0)}let vt=(()=>{class o{#t;constructor(n){this.dialog=n,this.hostClass="dialog-component",this.formValid=(0,l.vPA)(!1),this.canSave=(0,i.EW)(()=>this.formValid()),this.dropdownInsertValue=J.O,this.guidedContentType=!0,this.advancedMode=!1,this.#t=(0,g.d)(st.gs),this.scope=(0,l.vPA)(k.YX.scopes.default.value),this.scopeOptions=this.#t.getScopesSig(),this.contentTypes=this.#t.getTypes(this.scope).value}ngOnInit(){this.buildForm(),this.#e(),this.form.statusChanges.subscribe(()=>{this.formValid.set(this.form.valid)})}closeDialog(n){this.dialog.close(n)}toggleGuidedContentType(n){this.guidedContentType=n}toggleAdvancedMode(n){this.advancedMode=n.checked}saveAndClose(){const n=this.form.getRawValue();this.closeDialog(n.contentType)}#e(){this.dialog.keydownEvents().subscribe(n=>{(0,rt.YU)(n)&&this.canSave()&&(n.preventDefault(),this.saveAndClose())})}buildForm(){this.form=new U.J3({}),this.form.addControl("contentType",new U.hs(null,[U.k0.required])),this.form.addControl("scope",new U.hs(k.YX.scopes.default.value)),this.form.controls.scope.valueChanges.pipe((0,ot.Z)(this.form.controls.scope.value),(0,it.F)()).subscribe(n=>{null!=this.form.controls.contentType.value&&this.form.controls.contentType.patchValue(null),n===J.O?(n=prompt("This is an advanced feature to show content-types of another scope. Don't use this if you don't know what you're doing, as content-types of other scopes are usually hidden for a good reason.")||k.YX.scopes.default.value,this.scopeOptions().some(r=>r.value===n)||this.scopeOptions.set([{name:n,value:n},...this.scopeOptions()]),this.form.controls.scope.patchValue(n)):this.scope.set(n)})}static#a=this.\u0275fac=function(r){return new(r||o)(t.rXU(h.k))};static#n=this.\u0275cmp=t.VBU({type:o,selectors:[["app-metadata-save-dialog"]],hostVars:1,hostBindings:function(r,s){2&r&&t.Avn("className",s.hostClass)},decls:32,vars:15,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],["href","https://go.2sxc.org/metadata","target","_blank"],[3,"formGroup"],["color","accent",1,"eav-mat-form-field"],["formControlName","contentType","required","",3,"placeholder"],["matInput","","type","text","formControlName","contentType","required",""],["matTextSuffix",""],["mat-icon-button","","type","button","tippy","Pick existing value",3,"click","ngClass"],["mat-icon-button","","type","button","tippy","Manual entry",3,"click","ngClass"],[3,"isError"],["color","accent",3,"change","checked"],["align","end"],[3,"action","ngClass","disabled"],["formControlName","scope",3,"placeholder"],[3,"value"],["href","https://2sxc.org/help?tag=scope","target","_blank","appClickStopPropagation",""]],template:function(r,s){1&r&&(t.j41(0,"div",0)(1,"div",1)(2,"div",2),t.EFF(3," Create Metadata "),t.k0s(),t.j41(4,"button",3),t.bIt("click",function(){return s.closeDialog()}),t.j41(5,"mat-icon"),t.EFF(6,"close"),t.k0s()()(),t.j41(7,"div",4)(8,"p"),t.EFF(9," This is a special operation to add an item which as metadata for another item, see "),t.j41(10,"a",5),t.EFF(11,"docs"),t.k0s(),t.EFF(12,". "),t.k0s(),t.j41(13,"form",6),t.nVh(14,ht,12,2),t.j41(15,"mat-form-field",7)(16,"mat-label"),t.EFF(17,"Content Type"),t.k0s(),t.nVh(18,ut,3,1,"mat-select",8),t.nVh(19,ft,1,0,"input",9),t.j41(20,"div",10)(21,"button",11),t.bIt("click",function(){return s.toggleGuidedContentType(!0)}),t.j41(22,"mat-icon"),t.EFF(23,"search"),t.k0s()(),t.j41(24,"button",12),t.bIt("click",function(){return s.toggleGuidedContentType(!1)}),t.j41(25,"mat-icon"),t.EFF(26,"text_fields"),t.k0s()()()(),t.nVh(27,_t,2,1,"app-field-hint",13),t.j41(28,"mat-slide-toggle",14),t.bIt("change",function(j){return s.toggleAdvancedMode(j)}),t.EFF(29),t.k0s()()(),t.j41(30,"mat-dialog-actions",15)(31,"app-save-close-button-fab",16),t.bIt("action",function(){return s.saveAndClose()}),t.k0s()()()),2&r&&(t.R7$(13),t.Y8G("formGroup",s.form),t.R7$(),t.vxM(s.advancedMode&&s.guidedContentType?14:-1),t.R7$(4),t.vxM(s.guidedContentType?18:-1),t.R7$(),t.vxM(s.guidedContentType?-1:19),t.R7$(2),t.Y8G("ngClass",t.eq3(11,q,s.guidedContentType)),t.R7$(3),t.Y8G("ngClass",t.eq3(13,q,!s.guidedContentType)),t.R7$(3),t.vxM(s.form.controls.contentType.touched&&null!=s.form.controls.contentType.errors&&s.form.controls.contentType.errors.required?27:-1),t.R7$(),t.Y8G("checked",s.advancedMode),t.R7$(),t.SpI(" ",s.advancedMode?"Advanced":"Simple"," "),t.R7$(2),t.Y8G("ngClass",s.canSave()?"":"disabled")("disabled",!s.canSave()))},dependencies:[U.YN,U.qT,U.me,U.BC,U.cb,U.YS,U.X1,U.j4,U.JD,at.M,N.j,N.M,N.g,Z.M,Z.g,pt.M,nt.M,z.fS,z.fg,p.Hl,w.M,c.YU,D.m_,D.An,Q.mV,Q.sG,lt.F,dt.c,h.M,ct.i],styles:["mat-slide-toggle[_ngcontent-%COMP%]{margin-top:16px}"]})}return o})();var Ct=e(37580),Tt=e(3347),yt=e(58857);const Mt=o=>({"fab-opened":o});function Et(o,I){1&o&&t.EFF(0," This item is not metadata for anything else. ")}function Dt(o,I){if(1&o&&(t.nrm(0,"br"),t.EFF(1)),2&o){const n=t.XpG(2);t.R7$(),t.SpI("Key Number: ",n.itemFor().KeyNumber," ")}}function Pt(o,I){if(1&o&&(t.nrm(0,"br"),t.EFF(1)),2&o){const n=t.XpG(2);t.R7$(),t.SpI("Key Guid: ",n.itemFor().KeyGuid," ")}}function Ot(o,I){if(1&o&&(t.nrm(0,"br"),t.EFF(1)),2&o){const n=t.XpG(2);t.R7$(),t.SpI("Key String: ",n.itemFor().KeyString," ")}}function It(o,I){if(1&o&&(t.nrm(0,"br"),t.EFF(1)),2&o){const n=t.XpG(2);t.R7$(),t.SpI("Title: ",n.itemFor().Title," ")}}function Rt(o,I){if(1&o&&(t.EFF(0," This item is metadata for: "),t.nrm(1,"br"),t.EFF(2),t.nrm(3,"br"),t.EFF(4),t.nVh(5,Dt,2,1),t.nVh(6,Pt,2,1),t.nVh(7,Ot,2,1),t.nVh(8,It,2,1)),2&o){const n=t.XpG();t.R7$(2),t.SpI("Target: ",n.itemFor().Target," "),t.R7$(2),t.SpI("TargetType: ",n.itemFor().TargetType," "),t.R7$(),t.vxM(n.itemFor().KeyNumber?5:-1),t.R7$(),t.vxM(n.itemFor().KeyGuid?6:-1),t.R7$(),t.vxM(n.itemFor().KeyString?7:-1),t.R7$(),t.vxM(n.itemFor().Title?8:-1)}}function Ft(o,I){if(1&o&&t.nrm(0,"ag-grid-angular",6),2&o){let n;const r=t.XpG();t.Y8G("rowData",null==(n=r.metadataSet())?null:n.Items)("gridOptions",r.gridOptions)}}function At(o,I){if(1&o){const n=t.RV6();t.j41(0,"button",10),t.bIt("click",function(){l.eBV(n);const s=t.XpG();return l.Njj(s.createMetadata())}),t.j41(1,"mat-icon"),t.EFF(2,"add"),t.k0s()()}}function Ut(o,I){if(1&o&&(t.nrm(0,"div",19),t.nI1(1,"safeHtml")),2&o){const n=t.XpG().$implicit;t.Y8G("innerHTML",t.bMT(1,2,n.Icon),t.npT)("matBadgeIcon",n.Enabled?null:"diamond")}}function Bt(o,I){1&o&&(t.j41(0,"mat-icon"),t.EFF(1,"add"),t.k0s())}function xt(o,I){if(1&o){const n=t.RV6();t.j41(0,"button",18),t.bIt("click",function(){const s=l.eBV(n).$implicit,A=t.XpG(2);return l.Njj(A.createMetadata(s))}),t.nVh(1,Ut,2,4,"div",19)(2,Bt,2,0,"mat-icon"),t.k0s()}if(2&o){const n=I.$implicit,r=t.XpG(2);t.BMQ("label",n.Title),t.R7$(),t.vxM(n.Icon&&r.fabOpen()?1:2)}}function St(o,I){if(1&o){const n=t.RV6();t.j41(0,"eco-fab-speed-dial",11),t.bIt("openChange",function(s){l.eBV(n);const A=t.XpG();return l.Njj(A.openChange(s))}),t.j41(1,"eco-fab-speed-dial-trigger",12)(2,"button",13)(3,"mat-icon",14),t.EFF(4),t.k0s()()(),t.j41(5,"eco-fab-speed-dial-actions",15)(6,"button",16),t.bIt("click",function(){l.eBV(n);const s=t.XpG();return l.Njj(s.createMetadata())}),t.j41(7,"mat-icon"),t.EFF(8,"search"),t.k0s()(),t.Z7z(9,xt,3,2,"button",17,t.fX1),t.k0s()()}if(2&o){const n=t.XpG();t.Y8G("ngClass",t.eq3(3,Mt,n.fabOpen())),t.R7$(),t.Y8G("spin",!0),t.R7$(3),t.JRh(n.fabOpen()?"close":"add"),t.R7$(5),t.Dyx(n.recommendations())}}let jt=(()=>{class o{#t;#e;#a;#n;constructor(n,r,s,A,j){this.dialog=n,this.snackBar=r,this.matDialog=s,this.viewContainerRef=A,this.changeDetectorRef=j,this.log=(0,H.Tq)({MetadataComponent:o}),this.#t=(0,g.d)(tt.R),this.#e=(0,g.d)(T.TI),this.#a=(0,g.d)(M.F),this.#n=(0,g.d)(S.c),this.gridOptions=this.#p(),this.fabOpen=(0,l.vPA)(!1),this.#o=(0,E.C)(this.#n.getParams(["targetType","keyType","key","title","contentTypeStaticName"]),R=>({targetType:parseInt(R.targetType,10),keyType:R.keyType,key:R.key,contentTypeStaticName:R.contentTypeStaticName})),this.#i=this.#a.getAllOnce(this.#o.contentTypeStaticName).value,this.itemFor=(0,i.EW)(()=>{const R=this.#i()?.find(G=>G.Guid===this.#o.key);return R?.For?R.For:void 0}),this.refresh=(0,l.vPA)(0),this.#r=this.#e.getMetadataLive(this.refresh,this.#o.targetType,this.#o.keyType,this.#o.key).value,this.#s={empty:{description:"<p><b>This is where you manage Metadata</b></p>",hint:"<p>Click the (+) in the bottom right corner to create your first Metadata for the current item.</p>"},content:{description:"<p><b>Each row shows Metadata for the current item</b> <br>Metadata describes/configures something, similar to labels you could attach to clothes.</p>",hint:"<p>Click on the row to edit the Metadata. <br>You can also create new Metadata.</p>"}},this.uxHelpText=(0,i.EW)(()=>0===this.metadataSet()?.Items?.length?this.#s.empty:this.#s.content),this.metadataSet=(0,i.EW)(()=>{const R=this.#r();if(!R)return;const G=structuredClone(R);return G.Recommendations.forEach($=>{if($.Icon?.startsWith("base64:")){let Y=$.Icon.replace("base64:","");Y=window.atob(Y),Y=Y.replace('fill="#000000"','fill="#ffffff"'),$.Icon=Y}}),G}),this.recommendations=(0,i.EW)(()=>{const R=this.metadataSet();return R?.Recommendations.filter(G=>R?.Items.filter($=>$._Type.Id===G.Id).length<G.Count)}),this.title=(()=>{try{return decodeURIComponent(this.#n.getParam("title")??"")}catch{return console.error("Couldn't properly decode title"),this.#n.getParam("title")??""}})()}#o;#i;#r;#s;ngOnInit(){this.#n.doOnDialogClosed(()=>this.refresh.update(n=>n+1))}closeDialog(){this.dialog.close()}openChange(n){this.fabOpen.set(n)}createMetadata(n){if(n)return n.Enabled?void(n.CreateEmpty?(this.snackBar.open(`Creating ${n.Name}...`),this.#t.create(n.Id,{For:this.calculateItemFor("dummy").For}).subscribe({error:()=>{this.snackBar.open(`Creating ${n.Name} failed. Please check console for more info`,void 0,{duration:3e3}),this.refresh.update(s=>s+1)},next:()=>{this.snackBar.open(`Created ${n.Name}`,void 0,{duration:3e3}),this.refresh.update(s=>s+1)}})):this.createMetadataForm(n.Id)):void(0,u.j)(this.matDialog,n.MissingFeature,this.viewContainerRef,this.changeDetectorRef);this.matDialog.open(vt,{autoFocus:!1,viewContainerRef:this.viewContainerRef,width:"650px"}).afterClosed().subscribe(s=>{null!=s&&this.createMetadataForm(s)})}createMetadataForm(n){const r={items:[this.calculateItemFor(n)]},s=(0,L.s)(r);this.#n.navRelative([`edit/${s}`]),this.changeDetectorRef.markForCheck()}calculateItemFor(n){const r=W.c.constructMetadataInfo(this.#o.targetType,this.#o.keyType,this.#o.key);return W.c.newMetadataFromInfo(n,r)}#d(n){const r={items:[W.c.editId(n.Id)]},s=(0,L.s)(r);this.#n.navRelative([`edit/${s}`])}#l(n,r=!1){if(r)this.#t.delete(n._Type.Id,n.Id,!1).subscribe({next:()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.refresh.update(s=>s+1)},error:()=>{this.snackBar.open("Delete failed. Please check console for more information",null,{duration:3e3})}});else{const s={entityId:n.Id,entityTitle:n.Title,hasDeleteSnackbar:!0,message:this.metadataSet().Recommendations.find(j=>j.Id===n._Type.Id)?.DeleteWarning};this.matDialog.open(_.F,{autoFocus:!1,data:s,viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(j=>{j&&this.#l(n,!0)})}}#c(n){const r={items:[W.c.editId(n.Id)]},s=(0,L.s)(r);return"#"+this.#n.urlSubRoute(`edit/${s}`)}#p(){return{...B.C,columnDefs:[{...f.r.IdWithDefaultRenderer,cellRendererParams:f.r.idFieldParamsTooltipGetter()},{...f.r.TextWide,field:"Title",cellRenderer:r=>v.f.cellLink(this.#c(r.data),r.value),onCellClicked:r=>this.#d(r.data)},{...f.r.TextWide,headerName:"Content Type",field:"ContentType",valueGetter:r=>`${r.data._Type.Name}${r.data._Type.Title!==r.data._Type.Name?` (${r.data._Type.Title})`:""}`,cellRenderer:et},{...f.r.ActionsPinnedRight1,cellRenderer:K,cellRendererParams:{onDelete:r=>this.#l(r)}}]}}static#m=this.\u0275fac=function(r){return new(r||o)(t.rXU(h.k),t.rXU(Tt.UG),t.rXU(h.h),t.rXU(t.c1b),t.rXU(Ct.gRc))};static#h=this.\u0275cmp=t.VBU({type:o,selectors:[["app-metadata"]],decls:17,vars:8,consts:[[1,"eav-dialog","nav-component-wrapper"],[2,"height","100%",3,"helpText","refresh","rowLength"],["eav-dialog-header","",1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],["eav-dialog-content","",1,"eav-dialog-content"],[1,"ag-theme-material","eav-dialog-content",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab"],[1,"eav-eco-fab-speed-dial",3,"ngClass"],["mat-fab","","mat-elevation-z24","","tippy","Create a new metadata for this item",1,"grid-fab",3,"click"],[1,"eav-eco-fab-speed-dial",3,"openChange","ngClass"],[3,"spin"],["mat-fab","",1,"grid-fab"],[1,"spin180"],[1,"eav-eco-fab-speed-dial-actions"],["mat-mini-fab","","label","Other Content Type",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button"],["mat-mini-fab","",1,"eav-eco-fab-speed-dial-action-button",3,"click"],["matBadgeColor","accent","matBadgeSize","small","matBadgePosition","below after","aria-hidden","false",2,"color","white","fill","white",3,"innerHTML","matBadgeIcon"]],template:function(r,s){if(1&r&&(t.j41(0,"div",0)(1,"app-grid-with-help",1)(2,"div",2)(3,"div",3),t.EFF(4),t.k0s(),t.j41(5,"button",4),t.bIt("click",function(){return s.closeDialog()}),t.j41(6,"mat-icon"),t.EFF(7,"close"),t.k0s()()(),t.j41(8,"div",5)(9,"p"),t.nVh(10,Et,1,0)(11,Rt,9,6),t.k0s()(),t.nVh(12,Ft,1,2,"ag-grid-angular",6),t.j41(13,"mat-dialog-actions",7),t.nVh(14,At,3,0,"button",8),t.nVh(15,St,11,5,"eco-fab-speed-dial",9),t.k0s()()(),t.nrm(16,"router-outlet")),2&r){let A,j,R,G;t.R7$(),t.Y8G("helpText",s.uxHelpText())("refresh",s.refresh())("rowLength",null==(A=s.metadataSet())?null:A.Items.length),t.R7$(3),t.SpI(" ",s.title||"Metadata"," "),t.R7$(6),t.vxM(s.itemFor()?11:10),t.R7$(2),t.vxM((null==(j=s.metadataSet())?null:j.Items.length)>0?12:-1),t.R7$(2),t.vxM(0===(null==(R=s.recommendations())?null:R.length)?14:-1),t.R7$(),t.vxM((null==(G=s.recommendations())?null:G.length)>0?15:-1)}},dependencies:[p.Hl,p.$0,w.M,p.Sr,D.m_,D.An,C.n3,X.p,yt.xs,h.M,y.TE,c.YU,y.p1,y.yf,a.Y,x.A,V.$,d.v],styles:["[_nghost-%COMP%]     .ag-row-hover .ag-cell a, [_nghost-%COMP%]     .ag-row-hover .ag-cell .id-box *, [_nghost-%COMP%]     .ag-row-hover .ag-cell mat-icon, .eav-button__with-icon[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{color:#85283b!important}[_nghost-%COMP%]     .mat-button-wrapper div svg *:not([fill]){fill:#fff}"]})}return o})()},5858:(F,m,e)=>{e.d(m,{O:()=>c});const c="DROPDOWN_INSERT_VALUE"},12458:(F,m,e)=>{e.r(m),e.d(m,{PermissionsComponent:()=>V});var c=e(44444),l=e(84175),i=e(81863),a=e(93840),p=e(29658),h=e(12938),D=e(13620),C=e(6663),y=e(11828),g=e(60251),E=e(50052),_=e(91922),M=e(70334),u=e(67037),T=e(60852),v=e(89061),f=e(34601),d=e(99293),B=e(29968);let x=(()=>{class S{agInit(P){this.params=P}refresh(P){return!0}deletePermission(){this.params.onDelete(this.params.data)}static#t=this.\u0275fac=function(O){return new(O||S)};static#e=this.\u0275cmp=d.VBU({type:S,selectors:[["app-permissions-actions"]],decls:4,vars:0,consts:[[1,"actions-component"],["matRipple","","tippy","Delete",1,"eav-grid-action-button","highlight",3,"click"]],template:function(O,t){1&O&&(d.j41(0,"div",0)(1,"div",1),d.bIt("click",function(){return t.deletePermission()}),d.j41(2,"mat-icon"),d.EFF(3,"delete"),d.k0s()()())},dependencies:[v.M,B.M,a.m_,a.An,f.e],encapsulation:2})}return S})();var L=e(44900),H=e(3347),W=e(8923),X=e(58857);let V=(()=>{class S{#t;#e;#a;#n;#o;constructor(P,O,t,b){this.dialog=P,this.snackBar=O,this.viewContainerRef=t,this.matDialog=b,this.gridOptions=this.buildGridOptions(),this.#t=(0,h.d)(L.K),this.#e=(0,h.d)(T.c),this.#a=(0,D.C)(this.#e.getParams(["targetType","keyType","key"]),K=>({targetType:parseInt(K.targetType,10),keyType:K.keyType,key:K.key})),this.#n=(0,c.vPA)(0),this.permissions=this.#t.getAllLive(this.#a.targetType,this.#a.keyType,this.#a.key,this.#n),this.#o={[E.YX.metadata.language.targetType]:{PermissionType:"language"}}}ngOnInit(){this.#e.doOnDialogClosed(()=>this.#n.update(P=>P+1))}closeDialog(){this.dialog.close()}editPermission(P){let O;O=null==P?{items:[{...M.c.newMetadataFromInfo(E.YX.contentTypes.permissions,M.c.constructMetadataInfo(this.#a.targetType,this.#a.keyType,this.#a.key)),...this.#o[this.#a.targetType]&&{Prefill:this.#o[this.#a.targetType]}}]}:{items:[M.c.editId(P.Id)]};const t=(0,_.s)(O);this.#e.navRelative([`edit/${t}`])}#i(P){this.matDialog.open(C.F,{autoFocus:!1,data:{entityId:P.Id,entityTitle:P.Title,message:"Delete this permission?",hasDeleteSnackbar:!0},viewContainerRef:this.viewContainerRef,width:"400px"}).afterClosed().subscribe(b=>{b&&this.#t.delete(P.Id).subscribe(()=>{this.snackBar.open("Deleted",null,{duration:2e3}),this.#n.update(K=>K+1)})})}buildGridOptions(){return{...g.C,columnDefs:[{...y.r.Id,cellRendererParams:y.r.idFieldParamsTooltipGetter()},{...y.r.TextWide,headerName:"Name",field:"Title",sort:"asc",onCellClicked:O=>{this.editPermission(O.data)}},{...y.r.TextWide,field:"Identity"},{...y.r.TextWide,field:"Condition"},{...y.r.Character,field:"Grant"},{...y.r.ActionsPinnedRight1,cellRenderer:x,cellRendererParams:{onDelete:t=>this.#i(t)}}]}}static#r=this.\u0275fac=function(O){return new(O||S)(d.rXU(i.k),d.rXU(H.UG),d.rXU(d.c1b),d.rXU(i.h))};static#s=this.\u0275cmp=d.VBU({type:S,selectors:[["app-permissions"]],decls:15,vars:2,consts:[[1,"eav-dialog","nav-component-wrapper"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content","nav-component-wrapper"],[1,"grid-wrapper"],[1,"ag-theme-material",3,"rowData","gridOptions"],["align","end"],["mat-fab","","mat-elevation-z24","","tippy","Create a new permission",1,"grid-fab",3,"click"]],template:function(O,t){1&O&&(d.j41(0,"div",0)(1,"div",1)(2,"div",2),d.EFF(3,"Permissions"),d.k0s(),d.j41(4,"button",3),d.bIt("click",function(){return t.closeDialog()}),d.j41(5,"mat-icon"),d.EFF(6,"close"),d.k0s()()(),d.j41(7,"div",4),d.nrm(8,"router-outlet"),d.j41(9,"div",5),d.nrm(10,"ag-grid-angular",6),d.k0s(),d.j41(11,"mat-dialog-actions",7)(12,"button",8),d.bIt("click",function(){return t.editPermission(null)}),d.j41(13,"mat-icon"),d.EFF(14,"add"),d.k0s()()()()()),2&O&&(d.R7$(10),d.Y8G("rowData",t.permissions())("gridOptions",t.gridOptions))},dependencies:[l.Hl,W.M,l.Sr,a.m_,a.An,p.n3,i.M,u.p,X.xs],encapsulation:2})}return S})()},13620:(F,m,e)=>{function c(i,a){return a(i)}function l(i,a){return a(i)}e.d(m,{C:()=>c,z:()=>l})},21183:(F,m,e)=>{e.d(m,{f:()=>c});class c{static cellLink(i,a,p){return`<a class="default-link fill-cell ${p}" href="${i}">${a}</a>`}}},39333:(F,m,e)=>{e.d(m,{c:()=>i});var c=e(34435),l=e(99293);let i=(()=>{class a{constructor(){this.log=(0,c.Tq)({ClickStopPropagationDirective:a}),this.log.a("constructor")}onClick(h){this.log.a("onClick",{event:h}),h.stopPropagation()}static#t=this.\u0275fac=function(D){return new(D||a)};static#e=this.\u0275dir=l.FsC({type:a,selectors:[["","appClickStopPropagation",""]],hostBindings:function(D,C){1&D&&l.bIt("click",function(g){return C.onClick(g)})}})}return a})()},42365:(F,m,e)=>{e.d(m,{v:()=>l});var c=e(89204);const l={name:"SET_PERMISSIONS_DIALOG",initContext:!0,panelSize:"large",panelClass:null,getComponent:()=>(0,c.A)(function*(){const{PermissionsComponent:i}=yield Promise.all([e.e("default-node_modules_angular_forms_fesm2022_forms_mjs-node_modules_angular_material_fesm2022_-c07bbe"),e.e("default-projects_eav-ui_src_app_shared_directives_tippy_directive_ts"),e.e("default-node_modules_angular_material_fesm2022_radio_mjs"),e.e("default-projects_eav-ui_src_app_shared_ag-grid_column-definitions_ts-projects_eav-ui_src_app_-3cb379"),e.e("default-projects_eav-ui_src_app_app-administration_sub-dialogs_confirm-delete-dialog_confirm--93867c"),e.e("projects_eav-ui_src_app_permissions_permissions_component_ts-projects_eav-ui_src_app_shared_c-582bad")]).then(e.bind(e,12458));return i})()}},43516:(F,m,e)=>{e.r(m),e.d(m,{permissionRoutes:()=>a});var c=e(85544),l=e(42365),i=e(51195);const a=[{path:"",component:c.DialogEntryComponent,data:{dialog:l.v},children:i.RD}]},43758:(F,m,e)=>{e.d(m,{F:()=>u});var c=e(87945),l=e(37580),i=e(31016),a=e(99293),p=e(44444),h=e(87698);const D=["*"],C=T=>({"hint-box__short":T});function y(T,v){1&T&&a.eu8(0)}function g(T,v){if(1&T&&(a.j41(0,"mat-hint"),a.DNE(1,y,1,0,"ng-container",2),a.k0s()),2&T){a.XpG();const f=a.sdS(4);a.R7$(),a.Y8G("ngTemplateOutlet",f)}}function E(T,v){1&T&&a.eu8(0)}function _(T,v){if(1&T&&(a.j41(0,"mat-error"),a.DNE(1,E,1,0,"ng-container",2),a.k0s()),2&T){a.XpG();const f=a.sdS(4);a.R7$(),a.Y8G("ngTemplateOutlet",f)}}function M(T,v){1&T&&a.SdG(0)}let u=(()=>{class T{constructor(){this.isError=(0,l.hFB)(!1),this.isShort=!0}toggleIsShort(){this.isShort=!this.isShort}static#t=this.\u0275fac=function(d){return new(d||T)};static#e=this.\u0275cmp=a.VBU({type:T,selectors:[["app-field-hint"]],inputs:{isError:[1,"isError"]},ngContentSelectors:D,decls:5,vars:4,consts:[["content",""],[1,"hint-box",3,"click","ngClass"],[4,"ngTemplateOutlet"]],template:function(d,B){if(1&d){const x=a.RV6();a.NAR(),a.j41(0,"div",1),a.bIt("click",function(){return p.eBV(x),p.Njj(B.toggleIsShort())}),a.nVh(1,g,2,1,"mat-hint")(2,_,2,1,"mat-error"),a.k0s(),a.DNE(3,M,1,0,"ng-template",null,0,a.C5r)}if(2&d){let x;a.Y8G("ngClass",a.eq3(2,C,B.isShort)),a.R7$(),a.vxM(!1===(x=B.isError())?1:!0===x?2:-1)}},dependencies:[i.M,h.c,h.b,c.YU,c.T3],styles:[".hint-box[_ngcontent-%COMP%]{margin-top:4px}.hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{font-size:12px;display:block}.hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-hint[_ngcontent-%COMP%], .hint-box__short[_ngcontent-%COMP%]   .mat-mdc-form-field-error[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}"]})}return T})()},44900:(F,m,e)=>{e.d(m,{K:()=>C});var c=e(64173),l=e(70271),i=e(12938),a=e(50052),p=e(96817),h=e(80401),D=e(44444);let C=(()=>{class y{constructor(){this.metadataService=(0,i.d)(h.T),this.entitiesService=(0,i.d)(p.R)}getAll(E,_,M){return this.metadataService.getMetadata(E,_,M,a.YX.contentTypes.permissions).pipe((0,l.T)(u=>u.Items))}getAllLive(E,_,M,u){const T=this.metadataService.getMetadataLive(u,E,_,M,a.YX.contentTypes.permissions).value;return(0,c.EW)(()=>T()?.Items??[])}delete(E){return this.entitiesService.delete(a.YX.contentTypes.permissions,E,!1)}static#t=this.\u0275fac=function(_){return new(_||y)};static#e=this.\u0275prov=D.jDH({token:y,factory:y.\u0275fac})}return y})()},68163:(F,m,e)=>{e.d(m,{v:()=>y});var c=e(58857),l=e(37580),i=e(99293),a=e(64173),p=e(81863);const h=["gridWrapper"],D=[[["","eav-dialog-header",""]],[["","eav-dialog-content",""]],[["ag-grid-angular"]],[["mat-dialog-actions"]]],C=["[eav-dialog-header]","[eav-dialog-content]","ag-grid-angular","mat-dialog-actions"];let y=(()=>{class g{constructor(){this.gridWrapper=(0,l.ebz)("gridWrapper",{read:i.aKT}),this.agGrid=(0,l.sbv)(c.xs,{read:i.aKT}),this.dialogAction=(0,l.sbv)(p.M,{read:i.aKT}),this.helpText=l.hFB.required({}),this.refresh=l.hFB.required(),this.rowLength=l.hFB.required(),this.DEFAULT_ROW_HEIGHT=47,this.GRID_HEADER_HEIGHT=64,this.HELP_CARD_BUFFER=12,(0,a.QZ)(()=>{this.refresh();const M=this.rowLength(),u=this.gridWrapper()?.nativeElement;u&&(0,a.O8)(()=>this.#t(u,M))})}#t(_,M){const u=this.agGrid()?.nativeElement,T=this.dialogAction()?.nativeElement,v=_.querySelector(".help-info-card");setTimeout(()=>{if(v.classList.toggle("center-center",0===M),!u||!T)return;v.style.flex="";const f=this.#e(_,u,T,v,M);u.style.flex=f.rowHeight?`0 0 ${f.agGridHeight}px`:"0px";const d=document.querySelector(".mat-sidenav-content"),B=document.querySelector(".mat-mdc-dialog-container"),H=(document.querySelector(".nav-component-wrapper")?B:d).clientHeight-f.dialogHeaderHeight-f.dialogActionHeight-2;u.style.maxHeight=`${H}px`;const W=f.helpCardHeight+f.agGridHeight+f.dialogActionHeight+f.dialogHeaderHeight>f.wrapperHeight;v.style.flex="1 1 auto",v?.classList.toggle("hidden-help-info-card",W)},0)}#e(_,M,u,T,v){const f=M.querySelector(".ag-row")?.clientHeight??this.DEFAULT_ROW_HEIGHT;return{rowHeight:f,agGridHeight:this.GRID_HEADER_HEIGHT+v*f,helpCardHeight:T.clientHeight+this.HELP_CARD_BUFFER,dialogActionHeight:u.offsetHeight,dialogHeaderHeight:_.querySelector(".eav-dialog-header")?.clientHeight??0,wrapperHeight:_.offsetHeight}}static#a=this.\u0275fac=function(M){return new(M||g)};static#n=this.\u0275cmp=i.VBU({type:g,selectors:[["app-grid-with-help"]],contentQueries:function(M,u,T){1&M&&(i.C6U(T,u.agGrid,c.xs,5,i.aKT),i.C6U(T,u.dialogAction,p.M,5,i.aKT)),2&M&&i.NyB(2)},viewQuery:function(M,u){1&M&&i.wEZ(u.gridWrapper,h,5,i.aKT),2&M&&i.NyB()},inputs:{helpText:[1,"helpText"],refresh:[1,"refresh"],rowLength:[1,"rowLength"]},ngContentSelectors:C,decls:10,vars:2,consts:[["gridWrapper",""],[1,"grid-wrapper-dynamic"],[1,"help-info-card"],[1,"help-info-card-text"],[3,"innerHTML"]],template:function(M,u){1&M&&(i.NAR(D),i.j41(0,"div",1,0),i.SdG(2),i.SdG(3,1),i.SdG(4,2),i.j41(5,"div",2)(6,"div",3),i.nrm(7,"span",4)(8,"span",4),i.k0s()(),i.SdG(9,3),i.k0s()),2&M&&(i.R7$(7),i.Y8G("innerHTML",u.helpText().description,i.npT),i.R7$(),i.Y8G("innerHTML",u.helpText().hint,i.npT))},styles:[".grid-wrapper-dynamic[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%}.grid-wrapper-dynamic[_ngcontent-%COMP%]     .ag-theme-material.grid-dynamic{flex-shrink:0;flex-grow:0}.grid-wrapper-dynamic[_ngcontent-%COMP%]     .hidden-help-info-card{visibility:hidden!important;position:absolute!important}.grid-wrapper-dynamic[_ngcontent-%COMP%]     mat-dialog-actions{flex-shrink:0;margin-top:auto}.grid-wrapper-dynamic[_ngcontent-%COMP%]     mat-dialog-actions .eav-scope-dropdown{margin-top:-14px;width:350px}.help-info-card[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center}.help-info-card[_ngcontent-%COMP%]   .help-info-card-text[_ngcontent-%COMP%]{text-align:center;color:gray;width:30vw;max-width:400px;min-width:180px}.center-center[_ngcontent-%COMP%]{flex:1 1 auto}"]})}return g})()},72437:(F,m,e)=>{e.d(m,{k:()=>l});var c=e(50052);let l=(()=>{class i{static#t=this.route={path:"permissions/:targetType/:keyType/:key",loadChildren:()=>e.e("projects_eav-ui_src_app_permissions_permissions_routing_ts").then(e.bind(e,43516)).then(p=>p.permissionRoutes),data:{title:"Permissions"}};static getUrl(p,h,D){return`permissions/${p}/${h}/${D}`}static getUrlApp(p){return this.getUrl(c.YX.metadata.app.targetType,c.YX.metadata.app.keyType,p.toString())}static getUrlAttribute(p){return this.getUrl(c.YX.metadata.attribute.targetType,c.YX.metadata.attribute.keyType,p.toString())}static getUrlContentType(p){return this.getUrlEntity(p)}static getUrlEntity(p){return this.getUrl(c.YX.metadata.entity.targetType,c.YX.metadata.entity.keyType,p)}static getUrlLanguage(p){return this.getUrl(c.YX.metadata.language.targetType,c.YX.metadata.language.keyType,p)}}return i})()},80401:(F,m,e)=>{e.d(m,{T:()=>p});var c=e(96474),l=e(99293),i=e(44444);const a="admin/metadata/get";let p=(()=>{class h extends c.D{getMetadata(C,y,g,E){return this.getHttpApiUrl(a,{params:{appId:this.appId,targetType:C.toString(),keyType:y,key:g.toString(),...E&&{contentType:E}}})}getMetadataLive(C,y,g,E,_){return this.newHttpResource(()=>(C(),{url:this.apiUrl(a),params:{appId:this.appId,targetType:y.toString(),keyType:g,key:E.toString(),..._&&{contentType:_}}}))}getMetadataPromise(C,y,g,E){return this.fetchPromise(a,{params:{appId:this.appId,targetType:C.toString(),keyType:y,key:g.toString(),...E&&{contentType:E}}})}static#t=this.\u0275fac=(()=>{let C;return function(g){return(C||(C=l.xGo(h)))(g||h)}})();static#e=this.\u0275prov=i.jDH({token:h,factory:h.\u0275fac})}return h})()},96817:(F,m,e)=>{e.d(m,{R:()=>D});var c=e(47215),l=e(85837),i=e(9234),a=e(24467),p=e(99293),h=e(44444);let D=(()=>{class C extends a.B{create(g,E){return this.http.post(`app/auto/data/${g}`,E,{params:{appId:this.appId,zoneId:this.zoneId}})}update(g,E,_){return this.http.post(`app/auto/data/${g}/${E}`,_,{params:{appId:this.appId,zoneId:this.zoneId}})}delete(g,E,_){return this.http.delete(this.apiUrl(i.gb+"delete"),{params:{contentType:g,id:E.toString(),appId:this.appId,force:_.toString()},context:(new c._y).set(l.g,[400])})}static#t=this.\u0275fac=(()=>{let g;return function(_){return(g||(g=p.xGo(C)))(_||C)}})();static#e=this.\u0275prov=h.jDH({token:C,factory:C.\u0275fac})}return C})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.09/dist/ng-edit/projects_eav-ui_src_app_metadata_metadata_component_ts-projects_eav-ui_src_app_shared_service-802177.ad6da06356eb7a75.js.map