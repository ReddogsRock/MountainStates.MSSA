"use strict";(self.webpackChunkeav_ui=self.webpackChunkeav_ui||[]).push([["projects_eav-ui_src_app_app-administration_sub-dialogs_delete-extension_delete-extension_comp-79838c"],{22480:(I,u,t)=>{t.d(u,{h:()=>D});var M=t(70271),h=t(34435),g=t(96474),c=t(99293),_=t(44444);let D=(()=>{class r extends g.D{constructor(){super(...arguments),this.log=(0,h.Tq)({AppExtensionsService:r})}getAllLive(s){return this.newHttpResource(()=>(s(),{url:this.apiUrl("admin/appExtensions/extensions"),params:{appId:this.appId},method:"GET"}))}updateConfiguration(s,a){const o=JSON.parse(a);return this.http.post(this.apiUrl("admin/appExtensions/configuration"),o,{params:{zoneId:this.zoneId,appId:this.appId,name:s}})}downloadExtension(s){const a=new URLSearchParams({appId:this.appId,zoneId:this.zoneId,name:s}),o=`${this.apiUrl("admin/appExtensions/download")}?${a.toString()}`;window.open(o,"_blank","")}uploadExtensions(s,a){const o=new FormData;o.append("files",s);const E={appId:this.appId,zoneId:this.zoneId,...a?{editions:a}:{}};return this.http.post(this.apiUrl("admin/appExtensions/install"),o,{params:E}).pipe((0,M.T)(d=>({Success:d,Messages:d?[{MessageType:1,Text:"Extension uploaded successfully"}]:[{MessageType:2,Text:"Extension upload failed"}]})))}installPreflightExtension(s){const a=new FormData;return s.forEach(o=>a.append("files",o)),this.http.post(this.apiUrl("admin/appExtensions/installPreflight"),a,{params:{appId:this.appId,zoneId:this.zoneId}})}preflightExtension(s,a){const o={appId:this.appId,name:s};return a&&(o.edition=a),this.newHttpResource(()=>({url:this.apiUrl("admin/appExtensions/inspect"),params:o,method:"GET"}))}deleteExtension(s,a,o=!1,E=!1){const d={appId:this.appId,name:s,force:o,withData:E,...a?{edition:a}:{}};return this.http.delete(this.apiUrl("admin/appExtensions/delete"),{params:d})}static#e=this.\u0275fac=(()=>{let s;return function(o){return(s||(s=c.xGo(r)))(o||r)}})();static#t=this.\u0275prov=_.jDH({token:r,factory:r.\u0275fac})}return r})()},26167:(I,u,t)=>{t.r(u),t.d(u,{DeleteExtensionComponent:()=>T});var M=t(44444),h=t(34456),g=t(84175),c=t(81863),_=t(90353),D=t(93840),r=t(8827),v=t(3347),s=t(12938),a=t(32760),o=t(34601),E=t(99277),d=t(22480),P=t(94136),e=t(99293),O=t(29658),C=t(8923);let T=(()=>{class m{#e;#t;constructor(n,l,i){this.route=n,this.dialogData=l,this.dialog=i,this.#e=(0,M.WQX)(v.UG),this.#t=(0,s.d)(d.h),this.extensionFolder=this.route.snapshot.paramMap.get("extension"),this.withData=!1,this.withForceAllowed=!1,this.preflightResult=this.#t.preflightExtension(this.extensionFolder,"").value}ngOnInit(){this.#n()}#n(){this.dialog.keydownEvents().subscribe(n=>{(0,a.YU)(n)&&(n.preventDefault(),this.deleteAndClose())})}closeDialog(n){this.#e.dismiss(),n?this.dialog.close(n):this.dialog.close()}forceDeleteAndClose(n){n?this.executeDelete(!0):this.dialog.close(!1)}deleteAndClose(){this.evaluatePreflight()}evaluatePreflight(){const n=this.preflightResult(),l=n.summary,i=l.changed+l.added+l.missing;if(!n.files.some(x=>x.path.endsWith("App_Data/extension.json")&&"missing"!==x.status))return void this.executeDelete(!0);if(!n.foundLock)return void this.showError("Missing extension.lock.json. Deletion not allowed.");if(i>0&&!this.withForceAllowed)return void this.askForce(`The extension has file changes (${i}).`);const p=n.data.contentTypes.length;p>0&&!this.withForceAllowed?this.askForce(`The extension has data (${p} items).`):this.executeDelete(!1)}askForce(n){this.#e.open(`${n} Force delete?`,"Force",{duration:1e4}).onAction().subscribe(()=>this.executeDelete(!0))}executeDelete(n){this.#t.deleteExtension(this.extensionFolder,"",n,this.withData).subscribe({next:()=>{this.#e.open("Extension deleted successfully","OK",{duration:3e3}),this.dialog.close(!0)},error:l=>{this.showError(l?.error?.exceptionMessage??"Delete failed.")}})}showError(n){this.#e.open(n,"OK",{duration:8e3})}static#s=this.\u0275fac=function(l){return new(l||m)(e.rXU(O.nX),e.rXU(c.e),e.rXU(c.k))};static#a=this.\u0275cmp=e.VBU({type:m,selectors:[["app-delete-extension"]],decls:24,vars:5,consts:[[1,"eav-dialog"],[1,"eav-dialog-header"],[1,"eav-dialog-header__title"],["mat-icon-button","","tippy","Close dialog",3,"click"],[1,"eav-dialog-content"],[3,"expanded"],[1,"content"],[3,"data"],[3,"ngModelChange","ngModel"],["align","end"],["mat-button","",3,"click"],[3,"action","label"]],template:function(l,i){1&l&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2),e.EFF(3),e.k0s(),e.j41(4,"button",3),e.bIt("click",function(){return i.closeDialog()}),e.j41(5,"mat-icon"),e.EFF(6,"close"),e.k0s()()(),e.j41(7,"div",4)(8,"mat-accordion")(9,"mat-expansion-panel",5)(10,"mat-expansion-panel-header")(11,"mat-panel-title"),e.EFF(12,"Extension Details"),e.k0s()(),e.j41(13,"div",6),e.nrm(14,"app-inspect-extension-content",7),e.k0s()()(),e.j41(15,"p"),e.EFF(16,"Are you Sure you want to delete this Extension?"),e.k0s(),e.j41(17,"p")(18,"mat-slide-toggle",8),e.mxI("ngModelChange",function(p){return e.DH7(i.withData,p)||(i.withData=p),p}),e.EFF(19," Also delete data in the App which the extension created? "),e.k0s()()(),e.j41(20,"mat-dialog-actions",9)(21,"button",10),e.bIt("click",function(){return i.forceDeleteAndClose(!0)}),e.EFF(22,"Force Delete"),e.k0s(),e.j41(23,"app-save-close-button-fab",11),e.bIt("action",function(){return i.deleteAndClose()}),e.k0s()()()),2&l&&(e.R7$(3),e.SpI("Delete ",i.extensionFolder),e.R7$(6),e.Y8G("expanded",!0),e.R7$(5),e.Y8G("data",i.preflightResult()),e.R7$(4),e.R50("ngModel",i.withData),e.R7$(5),e.Y8G("label","Delete and close (ctrl + enter)"))},dependencies:[g.Hl,g.$z,C.M,D.m_,D.An,c.M,E.i,r.mV,r.sG,h.YN,h.BC,h.vS,_.MY,_.BS,_.GK,_.Z2,_.WN,P.o,o.e],styles:["mat-dialog-actions[_ngcontent-%COMP%]{gap:16px}"]})}return m})()}}]);
//# sourceMappingURL=https://sources.2sxc.org/20.00.09/dist/ng-edit/projects_eav-ui_src_app_app-administration_sub-dialogs_delete-extension_delete-extension_comp-79838c.d6946a20b7c18276.js.map